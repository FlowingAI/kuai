name: éƒ¨ç½²ç½‘ç«™

# è§¦å‘æ¡ä»¶ï¼šæŽ¨é€ä»£ç åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²
on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # 2. è®¾ç½®Node.js
      - name: ðŸ”§ è®¾ç½®Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # 3. å®‰è£…ä¾èµ–
      - name: ðŸ“¦ å®‰è£…ä¾èµ–
        run: npm install

      # 4. å¤åˆ¶æ•°æ®æ–‡ä»¶åˆ° public ç›®å½•
      - name: ðŸ“ å¤åˆ¶æ•°æ®æ–‡ä»¶
        run: node scripts/copy-data.js

      # 5. æž„å»ºå‰ç«¯
      - name: ðŸ—ï¸ æž„å»ºå‰ç«¯
        run: npm run build

      # 6. éƒ¨ç½²åˆ°GitHub Pages
      - name: ðŸ“¦ éƒ¨ç½²åˆ°GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist

      # 7. è¾“å‡ºæ‘˜è¦
      - name: ðŸ“Š è¾“å‡ºæ‘˜è¦
        run: |
          echo "## âœ… ç½‘ç«™éƒ¨ç½²æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "- éƒ¨ç½²æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
          echo "- æäº¤ä¿¡æ¯: ${{ github.event.head_commit.message }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— [æŸ¥çœ‹ç½‘ç«™](https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/)" >> $GITHUB_STEP_SUMMARY
