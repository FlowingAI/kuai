# 部署指南

## 📋 部署前准备

### 1. 获取API密钥

#### 智谱AI API密钥（必需）
1. 访问 [智谱AI开放平台](https://open.bigmodel.cn/)
2. 注册并登录
3. 进入API管理页面
4. 创建新的API密钥
5. 复制密钥（格式：`id.secret`）

#### Bing Search API密钥（可选但推荐）
1. 访问 [Microsoft Azure Portal](https://portal.azure.com/)
2. 搜索"Bing Search v7"
3. 创建新资源
4. 获取密钥
5. 免费额度：1000次查询/月

**如果没有Bing API密钥**：脚本会使用模拟数据（仅用于测试）

---

## 🚀 部署到GitHub Pages

### 步骤1：创建GitHub仓库

1. 在GitHub创建新仓库（例如：`flowingai`）
2. 不要初始化README（我们已经有了）

### 步骤2：推送代码到GitHub

```bash
# 初始化Git仓库
git init

# 添加所有文件
git add .

# 首次提交
git commit -m "Initial commit: 全球AI动态情报站"

# 添加远程仓库（替换为你的仓库地址）
git remote add origin https://github.com/你的用户名/flowingai.git

# 推送到GitHub
git branch -M main
git push -u origin main
```

### 步骤3：配置GitHub Secrets

1. 进入仓库的 **Settings** → **Secrets and variables** → **Actions**
2. 点击 **New repository secret**
3. 添加以下密钥：

| 密钥名称 | 值 | 必需 |
|---------|---|------|
| `ZHIPU_API_KEY` | 你的智谱AI API密钥 | ✅ 必需 |
| `BING_API_KEY` | 你的Bing Search API密钥 | ⚠️ 推荐 |
| `ADMIN_PASSWORD` | 管理后台密码（默认：admin123456） | ❌ 可选 |

### 步骤4：启用GitHub Pages

1. 进入仓库的 **Settings** → **Pages**
2. **Source** 选择：`GitHub Actions`

**重要**：不要选择 `Deploy from a branch`，因为我们用Actions自动构建和部署

### 步骤5：手动触发首次更新

1. 进入仓库的 **Actions** 标签页
2. 选择 "更新AI动态" workflow
3. 点击 **Run workflow** → **Run workflow**
4. 等待执行完成（约5-10分钟）

### 步骤6：访问网站

网站地址：`https://你的用户名.github.io/flowingai/`

---

## 🔧 本地开发

### 安装依赖

```bash
npm install
```

### 配置环境变量

创建 `.env` 文件（不提交到Git）：

```bash
# 智谱AI API密钥
ZHIPU_API_KEY=你的密钥

# Bing Search API密钥（可选）
BING_API_KEY=你的密钥

# 管理后台密码（可选，默认admin123456）
VITE_ADMIN_PASSWORD=你的密码
```

### 运行开发服务器

```bash
npm run dev
```

访问 `http://localhost:5173`

### 手动更新数据

```bash
npm run fetch
```

### 构建生产版本

```bash
npm run build
```

构建产物在 `dist/` 目录

---

## 📊 监控和调试

### 查看更新日志

1. 进入 **Actions** 标签页
2. 点击最近的workflow运行记录
3. 查看详细日志
4. 在Summary中可以看到更新统计

### 常见问题

#### 1. Workflow执行失败

**原因**：
- API密钥未设置或错误
- API额度耗尽
- 网络超时

**解决**：
- 检查 Secrets 配置
- 查看Actions日志
- 手动重试

#### 2. 网站无法访问

**原因**：
- GitHub Pages未启用
- Workflow未成功部署

**解决**：
- 等待首次Workflow完成
- 检查Pages设置

#### 3. 数据未更新

**原因**：
- 没有新数据
- API过滤掉了所有内容

**解决**：
- 查看Actions日志
- 检查过滤规则

---

## 🔄 更新流程

### 自动更新

- **频率**：每4小时
- **北京时间**：0:00, 4:00, 8:00, 12:00, 16:00, 20:00
- **每次更新**：最多60条新闻/模块

### 手动更新

在GitHub Actions页面点击 **Run workflow** 即可

---

## 🔐 安全建议

1. **永远不要**在代码中硬编码API密钥
2. **永远不要**把 `.env` 文件提交到Git
3. 定期更换API密钥
4. 使用强密码作为管理后台密码
5. 监控API使用量，避免超额

---

## 📝 配置说明

### 修改更新频率

编辑 `.github/workflows/update-news.yml`：

```yaml
schedule:
  # 每2小时：'0 */2 * * *'
  # 每6小时：'0 */6 * * *'
  # 每4小时：'0 */4 * * *'
  - cron: '0 */4 * * *'
```

### 修改每次更新数量

编辑 `scripts/sources.js`：

```javascript
export const fetchConfig = {
  newsCountPerCategory: 60,  // 改为你想要的数量
  // ...
}
```

### 修改搜索关键词

编辑 `scripts/sources.js` 中的 `categories` 配置

---

## ✅ 部署检查清单

- [ ] GitHub仓库已创建
- [ ] 代码已推送到GitHub
- [ ] GitHub Secrets已配置（ZHIPU_API_KEY）
- [ ] GitHub Pages已启用（使用GitHub Actions）
- [ ] 首次手动触发workflow成功
- [ ] 网站可以正常访问
- [ ] 数据文件已生成（data/*.json）
- [ ] 管理后台可以登录

---

## 🆘 需要帮助？

如果遇到问题：
1. 查看 [故障排除](./故障排除.md)
2. 检查 [GitHub Issues](https://github.com/你的用户名/flowingai/issues)
3. 查看Actions日志
