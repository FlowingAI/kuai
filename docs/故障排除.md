# 故障排除

## 🔧 常见问题

### 1. 网站无法访问

#### 症状
- 访问 `https://你的用户名.github.io/flowingai/` 显示404

#### 原因
- GitHub Pages未启用
- 首次部署未完成
- 仓库名称不匹配

#### 解决方法
1. 检查GitHub Pages设置：
   - Settings → Pages
   - Source应选择：`GitHub Actions`
2. 等待首次workflow完成（约5-10分钟）
3. 确认仓库名称正确

---

### 2. 数据不显示

#### 症状
- 网站可以访问，但所有模块显示"暂无数据"

#### 原因
- 数据文件不存在或为空
- API密钥未配置或错误
- Workflow未执行

#### 解决方法
1. 检查 `data/` 目录是否有 `.json` 文件
2. 检查GitHub Secrets是否配置了 `ZHIPU_API_KEY`
3. 手动触发workflow：
   - Actions → 更新AI动态 → Run workflow
4. 查看workflow日志确认错误

---

### 3. Workflow执行失败

#### 症状
- Actions页面显示红色❌
- 日志中有错误信息

#### 常见错误

**错误1：`ZHIPU_API_KEY not found`**
- 原因：未配置密钥
- 解决：Settings → Secrets → 添加 `ZHIPU_API_KEY`

**错误2：`API request failed`**
- 原因：API密钥错误或额度耗尽
- 解决：
  1. 检查密钥是否正确
  2. 检查智谱AI账户余额
  3. 重新生成密钥

**错误3：`Timeout`**
- 原因：网络超时或API响应慢
- 解决：等待自动重试，或手动重新运行

---

### 4. 管理后台无法登录

#### 症状
- 输入密码后提示"密码错误"

#### 原因
- 密码不正确
- 环境变量未设置

#### 解决方法
1. 默认密码：`admin123456`
2. 如果修改过密码：
   - 检查Secrets中的 `ADMIN_PASSWORD`
   - 本地开发检查 `.env` 中的 `VITE_ADMIN_PASSWORD`

---

### 5. 数据未更新

#### 症状
- 显示"最后更新"是几天前
- Workflow执行成功但没有新数据

#### 原因
- 没有符合条件的新闻
- API过滤掉了所有内容
- 搜索关键词不匹配

#### 解决方法
1. 查看workflow日志：
   - 搜索"共采集到"确认采集数量
   - 查看"处理完成"确认有效数量
2. 如果采集为0：
   - 检查Bing API密钥
   - 修改搜索关键词（`scripts/sources.js`）
3. 如果有效为0：
   - 调整AI过滤规则（`scripts/zhipu-api.js`）

---

### 6. 英文新闻未翻译

#### 症状
- 英文新闻显示的还是英文

#### 原因
- AI处理失败
- API返回格式错误

#### 解决方法
1. 查看workflow日志找到具体错误
2. 检查智谱AI API是否正常
3. 重新运行workflow

---

### 7. 本地开发失败

#### 症状
- `npm install` 失败
- `npm run dev` 启动失败

#### 解决方法

**问题1：npm install失败**
```bash
# 清理缓存
npm cache clean --force

# 删除node_modules重新安装
rm -rf node_modules package-lock.json
npm install
```

**问题2：端口被占用**
```bash
# 使用其他端口
npm run dev -- --port 3000
```

**问题3：.env文件未找到**
- 确保 `.env` 文件在项目根目录
- 文件内容格式正确：
  ```
  ZHIPU_API_KEY=你的密钥
  ```

---

## 📊 调试技巧

### 查看详细日志

1. 进入GitHub Actions
2. 点击失败的workflow运行
3. 展开"🤖 采集AI动态"步骤
4. 查看完整日志

### 本地测试脚本

```bash
# 设置环境变量（PowerShell）
$env:ZHIPU_API_KEY="你的密钥"
$env:BING_API_KEY="你的密钥"

# 运行脚本
node scripts/fetch-news.js
```

### 检查数据文件

```bash
# 查看数据文件内容
cat data/global-ai.json

# 检查JSON格式
node -e "console.log(JSON.parse(require('fs').readFileSync('data/global-ai.json')))"
```

---

## 🔍 日志解读

### 正常运行的日志

```
📡 正在采集: 全球AI动态
  🌐 采集英文新闻 (目标: 60条)
  🇨🇳 采集中文新闻 (目标: 40条)
  📊 共采集到 180 条原始新闻
  🤖 正在用智谱AI处理 180 条新闻...
  ✅ 处理完成: 55/180 条有效新闻
  ✅ 已保存 155 条新闻到 global-ai.json
```

### 异常运行的日志

```
⚠️  全球AI动态 没有采集到新数据，跳过
```
→ 检查Bing API密钥

```
❌ 全球AI动态 处理失败: API request failed
```
→ 检查智谱AI密钥

```
✅ 处理完成: 0/180 条有效新闻
```
→ 所有新闻被过滤，调整过滤规则

---

## 🆘 紧急恢复

### 数据误删恢复

如果误删除了数据文件：

1. 进入GitHub仓库
2. 点击 `commits` 查看提交历史
3. 找到删除前的提交
4. 点击 `Browse files` 查看旧版本
5. 手动复制数据文件内容
6. 创建新的commit恢复

### 网站崩溃恢复

1. 回滚到上一个稳定版本：
   ```bash
   git log --oneline
   git revert <commit-hash>
   git push
   ```

2. 禁用自动更新：
   - Settings → Actions → Disable workflow

---

## 📞 获取帮助

如果以上方法都无法解决问题：

1. **查看GitHub Issues**：是否有类似问题
2. **创建新Issue**：
   - 描述问题症状
   - 附上错误日志
   - 说明操作系统和浏览器
3. **联系技术支持**

---

## 📝 已知问题

### 当前版本问题

1. **Bing API限流**
   - 免费版有请求限制
   - 建议：升级到付费版或使用多密钥轮换

2. **AI处理速度慢**
   - 单次更新可能需要5-10分钟
   - 建议：耐心等待或减少采集数量

3. **管理后台删除功能受限**
   - GitHub Pages是静态托管
   - 建议：配置GitHub API或使用其他方案

### 修复计划

- [ ] 添加多密钥轮换机制
- [ ] 优化AI处理并发度
- [ ] 实现完整的后台管理API
